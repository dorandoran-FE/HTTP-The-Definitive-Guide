# 3장 HTTP 메시지 (78-113)

- 3장에서 배울것
  - 메시지가 어떻게 흘러가는가
  - HTTP 메시지의 세 부분(시작줄, 헤더, 개체 본문)
  - 요청과 응답 메시지의 차이
  - 요청 메시지가 지원하는 여러 기능(메서드)들
  - 응답 메시지가 반환하는 여러 상태 코드들
  - 여러 HTTP 헤더들은 무슨 일을 하는가

## 1. 메시지의 흐름
- HTTP 메시지는 HTTP 애플리케이션 간에 주고받은 데이터의 블록들!
- 메세지는 클라이언트, 서버, 프락시 사이를 흐름

1. 메시지는 원 서버 방향을 인바운드로 하여 송신된다
- 트랜젝션 방향 표현 방식 : 인바운드(서버로), 아웃바운드(클라이언트로)

2. 다운스트림으로 흐르는 메시지
- 모든 메시지는 다운스트림으로 흐른다!

## 2. 메시지의 각 부분
- 시작줄, 헤더 블록, 본문 으로 나뉨
- 시작줄 : 어떤 메시지인지 서술. 줄 단위로 분리된 아스키 문자열.
- 헤더 : 속성. 줄 단위로 분리된 아스키 문자열.
- 본문 : 데이터를 담음 (없을 수도 있음). 텍스트나 이진 데이터를 포함할 수 있음.

### 1. 메시지 문법
- 모든 HTTP 메시지는 요청 메시지나 응답 메시지로 분류됨
- 요청 메시지 형식
  ```plaintext
  <메서드> <요청 URL> <버전>
  <헤더>
  <엔터티 본문> 
  ```
- 응답 메시지 형식
  ```plaintext
  <버전> <상태 코드> <사유 구절>
  <헤더>
  <엔터티 본문>
  ```
- 메서드 : 클라이언트 측에서 서버가 리소스에 대해 수행해주길 바라는 동작
- 요청 URL : 요청 대상이 되는 리소스를 지칭하는 URL 혹은 URL의 경로 구성 요소
- 버전 : 메세지에서 사용 중인 HTTP 버전
- 상태 코드 : 요청 중에 무엇이 일어났는지 설명하는 세 자리 숫자
- 사유 구절 : 상태 코드의 의미를 설명하는 짧은 문구
- 헤더들 : 이름, 콜론, 선택적인 공백, 값, CRLF가 순서대로 나타나는 0개 이상의 헤더들
- 엔터티 본문 : 임의의 데이터 블록을 포함

### 2. 시작줄 : 무엇을 해야 하는지 말해줌
- 요청줄 : 서버에게 리소스에 대해 무언가를 해달라고 부탁 -> 메서드와 요청 URL, HTTP 버전 포함. 모든 필드는 공백으로 구분됨
- 응답줄 : 수행 결과에 대한 상태 정보와 결과 데이터를 클라이언트에게 돌려줌 -> HTTP 버전, 상태 코드, 사유 구절. 모든 필드는 공백으로 구분
- 메서드 : 요청의 시작줄은 메서드로 시작. 서버에게 무엇을 해야 하는지 말해줌. 

| 메서드   | 설명                                   |본문 O/X?
|----------|----------------------------------------|------|
| **GET**  | 서버에서 어떤 문서 가져오기       |X|
| **HEAD**  | 서버에서 어떤 문서에 대해 헤더만 가져오기       |X|
| **POST** | 서버가 처리해야 할 데이터 보내기|O|
| **PUT**  | 서버에 요청 메시지의 본문 저장하기|O|
| **TRACE** | 메시지가 프락시를 거쳐 서버에 도달하는 과정을 추적   |X|
| **OPTIONS** | 서버가 어떤 메서드를 수행할 수 있는지 확인       |X|
| **DELETE** | 서버에서 문서를 제거            |X|
- 상태 코드 : 응답 메시지의 시작줄에 담겨 반환

| 전체 범위 | 정의된 범위                           | 분류 |
|-----------|-----------------------------------|---|
| **100-199**   | 100-101 | 정보 |
| **200-299**   | 200-206 |성공 |
| **300-399**   | 300-305 |리다이렉션 |
| **400-499**   | 400-415 |클라이언트 에러|
| **500-599**   | 500-505 |서버 에러|

- 사유 구절 : 응답 시작줄의 마지막 구성요소. 상태 코드에 대한 글로 된 설명 제공.
- 버전 번호 : HTTP/x.y 형식으로 요청과 응답 메시지 양쪽 모두에 기술됨. 버전 번호는 어떤 애플리케이션이 지원하는 가장 높은 HTTP 버전을 가리킴.

### 3. 헤더
| 헤더 분류   | 설명                                   |
|----------|----------------------------------------|
| **일반 헤더**  | 요청과 응답 양쪽에 모두 나타날 수 있음         |
| **요청 헤더** | 요청에 대한 부가 정보를 제공  |
| **응답 헤더**  | 응답에 대한 부가 정보를 제공 |
| **Entity 헤더** | 본문 크기와 콘텐츠, 혹은 리소스 그 자체를 서술  |
| **확장 헤더** | 명세에 적으이되지 않은 새로운 헤더           |

### 4. 엔터티 본문

### 5. 버전 0.9 메시지
- HTTP 버전 0.9는 HTTP 프로토콜의 초기 버전

## 3. 메서드
### 1. 안전한 메서드
- HTTP는 안전한 메서드라 불리는 메서드의 집합을 정의   
  -> GET과 HEAD 메서드는 안전   
  -> GET이나 HEAD 메서드를 사용하는 HTTP 요청의 결과로 서버에 어떤 작용도 없음을 의미

### 2. GET
- 서버에게 리소스를 달라고 요청

### 3. HEAD
- 정확히 GET 처럼 행동하지만, 응답으로 헤더만 돌려줌.
- 리소스를 가져오지 않고도 그에 대해 무엇인가를 알아낼 수 있음(타입이라거나)
- 응답의 상태 코드를 통해, 개체가 존재하는지 확인 가능
- 헤더를 확인하여 리소스 변경되었는지 검사 가능

### 4. PUT
- 서버가 요청의 본문을 가지고 요청 URL의 이름대로 새 문서를 만들거나, 이미 URL이 존재한다면 본문을 사용해서 교체

### 5. POST
- 서버에 입력 데이터를 전송하기 위해 설계됨.

### 6. TRACE
- 클라이언트에게 자신의 요청이 서버에 도달했을 때 어떻게 보이게 되는지 알려줌.
- 주로 진단을 위해 사용.
  - 예 : 요청이 의도한 요청/응답 연쇄를 거쳐가는지 검사 가능
- 또는 프락시나 다른 애플리케이션들이 요청에 어떤 영향을 미치는지 확인 가능

### 7. OPTIONS
- 웹 서버에게 여러 가지 종류의 지원 범위에 대해 물어봄
- 서버에게 특정 리소스에 대해 어떤 메서드가 지원되는지 물어볼 수 있음

### 8. DELETE
- 서버에게 요청 URL로 지정한 리소스를 삭제 요청
- 그러나 클라이언트는 삭제가 수행되는 것을 보장하지 못함!~

### 9. 확장 메서드
- 필요에 따라 확장 가능
- LOCK, MKCOL, COPY, MOVE 등이 있음!

## 4. 상태 코드
- 상태 코드는 클라이언트에게 그들의 트랜젝션을 이해할 수 있는 쉬운 방법을 제공함

### 1. 100-199 : 정보성 상태 코드
### 2. 200-299 : 성공 상태 코드

| 상태 코드 | 사유 구절      | 의미 |
|-----------|---------------|-----------|
| **200**   | OK | 요청은 정상, 엔터티 본문은 요청된 리소스를 포함 |
| **204**   | No Content |응답 메시지는 헤더와 상태줄을 포함, 엔터티 본문은 포함하지 않음 |

### 3. 300-399 : 리다이렉션 상태 코드
- 클라이언트가 원하는 리소스에 대해 다른 위치를 사용하라고 말해주거나, 그 리소스의 내용 대신 다른 대안 응답을 제공
- 304 : 조건부 요청(특정 일자 이후 수정된 경우에만 문서를 가져오도록 If-Modified-Since 헤더를 사용하는 경우)   
  -> 그 문서가 그 날짜 이후 변한 것이 없다면   
  -> 서버는 콘텐츠 대신 304 상태 코드로 응답   
  -> 브라우저는 로컬 복사본을 보여줌

